<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive - Structures</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 100vh;
        }
        h1 {
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Répartition des mes structures d'études, de stages et de travail</h1>
    <div id="map"></div>

    <script>
        // Initialisation de la carte
        const map = L.map('map').setView([48.8566, 2.3522], 5); // Vue centrée sur la France

        // Ajout du fond de carte OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Données GeoJSON
        const geojsonData = {
            "type": "FeatureCollection",
            "name": "Structures",
            "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::2154" } },
            "features": [
                { "type": "Feature", "properties": { "fid": 1.0, "Structures": "Lycée de Kébémer", "Infos": "https://mapcarta.com/W258963568" }, "geometry": { "type": "Point", "coordinates": [ -1655437.410714491270483, 3284270.328692390583456 ] } },
                { "type": "Feature", "properties": { "fid": 2.0, "Structures": "Université Cheikh Anta Diop de Dakar", "Infos": "https://flsh.ucad.sn/content/d%C3%A9partement-de-g%C3%A9ographie-0" }, "geometry": { "type": "Point", "coordinates": [ -1798831.228852201718837, 3230084.531651670113206 ] } },
                { "type": "Feature", "properties": { "fid": 3.0, "Structures": "Université de Rouen", "Infos": "https://formation.univ-rouen.fr/fr/catalogue-de-l-offre-de-formation/licence-lmd-XA/licence-geographie-et-amenagement-L516F76X.html" }, "geometry": { "type": "Point", "coordinates": [ 559868.898867637850344, 6930437.355676788836718 ] } },
                { "type": "Feature", "properties": { "fid": 4.0, "Structures": "Université Paris Sorbonne Nord", "Infos": "https://odf.univ-spn.fr/fr/offre-de-formation/master-lmd-XB/master-mention-geographie-parcours-territoires-et-developpement-durable-I8K6LR2K.html" }, "geometry": { "type": "Point", "coordinates": [ 651730.182126459316351, 6873209.299038667231798 ] } },
                { "type": "Feature", "properties": { "fid": 5.0, "Structures": "Université d'Orléans", "Infos": "https://www.univ-orleans.fr/upload/public/2019-05/Plaquette%20Master%20GLET.pdf" }, "geometry": { "type": "Point", "coordinates": [ 620436.303099277662113, 6749601.730748078785837 ] } },
                { "type": "Feature", "properties": { "fid": 6.0, "Structures": "Université Paris 1 Panthéon Sorbonne", "Infos": "https://formations.pantheonsorbonne.fr/fr/catalogue-des-formations/master-M/master-risques-et-environnement-KBURPBB4/master-parcours-teledetection-et-geomatique-appliquees-a-l-environnement-tgae-KBURQQ8P.html" }, "geometry": { "type": "Point", "coordinates": [ 651981.802898756926879, 6860890.205839461646974 ] } },
                { "type": "Feature", "properties": { "fid": 7.0, "Structures": "Tribu Concevoire Durable", "Infos": "https://www.tribu.coop/" }, "geometry": { "type": "Point", "coordinates": [ 654410.943680263822898, 6865686.192639978602529 ] } },
                { "type": "Feature", "properties": { "fid": 8.0, "Structures": "Wanaka", "Infos": "https://www.wanaka.io/" }, "geometry": { "type": "Point", "coordinates": [ 650282.096515660290606, 6860504.262276619672775 ] } },
                { "type": "Feature", "properties": { "fid": 9.0, "Structures": "Office National des Forêts", "Infos": "https://www.onf.fr/" }, "geometry": { "type": "Point", "coordinates": [ 688105.275578379281797, 6923569.705051010474563 ] } }
            ]
        };

        // Ajouter une projection compatible pour les coordonnées
        function convertCoordinates(coord) {
            const proj4 = window.proj4;
            proj4.defs("EPSG:2154", "+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +units=m +no_defs");
            const [lon, lat] = proj4("EPSG:2154", "EPSG:4326", coord);
            return [lat, lon];
        }

        // Ajout des points GeoJSON
        L.geoJSON(geojsonData, {
            pointToLayer: function (feature, latlng) {
                const coords = convertCoordinates(feature.geometry.coordinates);
                return L.marker(coords);
            },
            onEachFeature: function (feature, layer) {
                const popupContent = `<strong>${feature.properties.Structures}</strong><br><a href="${feature.properties.Infos}" target="_blank">Plus d'infos</a>`;
                layer.bindPopup(popupContent);
            }
        }).addTo(map);
    </script>
</body>
</html>
